const fs = require("fs");

function parseSlokesWithChapter(text, chapterNumber = 2) {
  // Normalize whitespaces
  text = text.replace(/\s+/g, " ").trim();

  // Sloke + number detect
  const slokePattern = /(.*?॥([০-৯]+)॥)/gs;
  const matches = [...text.matchAll(slokePattern)];

  const slokes = {};

  matches.forEach((match) => {
    const sloke = match[1].trim();
    const number = match[2];
    slokes[number] = { Sloke: sloke };
  });

  return {
    Chapter: chapterNumber,
    Slokes: slokes,
  };
}

// Example Gita text
const gitaText = `

অর্জ্জুন উবাচ—কিন্তদ্ব্রহ্ম কিমধ্যাত্মং কিং কর্ম্ম পুরুষোত্তম।
অধিভূতঞ্চ কিং প্রোক্তমধিদৈবং কিমুচ্যতে॥১॥
অধিযজ্ঞঃ কথং কোঽত্র দেহেঽস্মিন্ মধুসূদন।
প্রয়াণকালে চ কথং জ্ঞেয়োঽসি নিয়তাত্মভিঃ॥২॥
শ্রীভগবান্ উবাচ—অক্ষরং পরমং ব্রহ্ম স্বভাবোঽধ্যাত্মমুচ্যতে।
ভূতভাবোদ্ভবকরো বিসর্গঃ কর্ম্মসংজ্ঞিতঃ॥৩॥
অধিভূতং ক্ষরো ভাবঃ পুরুষশ্চাধিদৈবতম্।
অধিযজ্ঞোঽহমেবাত্র দেহে দেহভৃতাং বর॥৪॥
অন্তকালে চ মামেব স্মরন্ মুক্ত্বা কলেবরম্।
যঃ প্রয়াতি স মদ্ভাবং যাতি নাস্ত্যত্র সংশয়ঃ॥৫॥
যং যং বাপি স্মরন্ ভাবং ত্যজত্যন্তে কলেবরম্।
তং তমেবৈতি কৌন্তেয় সদা তদ্ভাবভাবিতঃ॥৬॥
তস্মাৎ সর্ব্বেষু কালেষু মামনুস্মর যুধ্য চ।
ময্যর্পিতমনোবুদ্ধির্ন্মামেবৈষ্যস্যসংশয়ঃ॥৭॥
অভ্যাসযোগযুক্তেন চেতসা নান্যগামিনা।
পরমং পুরুষং দিব্যং যাতি পার্থানুচিন্তয়ন্॥৮॥
কবিং পুরাণমনুশাসিতারমণোরণীয়াংসমনুস্মরেদ্ যঃ।
সর্ব্বস্য ধাতারমচিন্ত্যরূপমাদিত্যবর্ণং তমসঃ পরস্তাৎ॥৯॥
প্রয়াণকালে মনসাঽচলেন,
ভক্ত্যা যুক্তোযোগবলেন চৈব।
ভ্রুবোর্ম্মধ্যে প্রাণমাবেশ্য সম্যক্,
স তং পরং পুরুষমুপৈতি দিব্যম্॥১০॥
যদক্ষরং বেদবিদো বদন্তি,
বিশন্তি যদ্যতয়ো বীতরাগাঃ।
যদিচ্ছন্তো ব্রহ্মচর্য্যং চরন্তি,
তত্তে পদং সংগ্রহেণ প্রবক্ষ্যে॥১১॥
সর্ব্বদ্বারাণি সংযম্য মনো হৃদি নিরুধ্য চ।
মূর্দ্ধ্ন্যাধায়াত্মনঃ প্রাণমাস্থিতো যোগধারণাম্॥১২॥
ওমিত্যেকাক্ষরং ব্রহ্ম ব্যাহরন্মামনুস্মরন্।
য প্রয়াতি ত্যজন্ দেহং স যাতি পরমাং গতিম্॥১৩॥
অনন্যচেতাঃ সততং যো মাং স্মরতি নিত্যশঃ।
তস্যাহং সুলভঃ পার্থ নিত্যযুক্তস্য যোগিনঃ॥১৪॥
মামুপেত্য পুনর্জন্মদুঃখালয়মশাশ্বতম্।
নাপ্নুবন্তি মহাত্মানঃ সংসিদ্ধিং পরমাং গতাঃ॥১৫॥
আব্রহ্মভুবনাল্লোকাঃ পুনরাবর্ত্তিনোঽর্জ্জুন।
মামুপেত্য তু কৌন্তেয় পুনর্জন্ম ন বিদ্যতে॥১৬॥
সহস্রযুগপর্য্যন্তমহর্যদ্ব্রহ্মণো বিদুঃ।
রাত্রিং যুগসহস্রান্তাং তেঽহোরাত্রবিদো জনাঃ॥১৭॥
অব্যক্তাদ্ব্যক্তয়ঃ সর্ব্বাঃ প্রভবন্ত্যহরাগমে।
রাত্র্যাগমে প্রলীয়ন্তে তত্রৈবাব্যক্তসংজ্ঞকে॥১৮॥
ভূতগ্রামঃ স এবায়ং ভূত্বা ভূত্বা প্রলীয়তে।
রাত্র্যাগমেঽবশঃ পার্থ প্রভবত্যহরাগমে॥১৯॥
পরস্তস্মাত্তু ভাবোঽন্যোঽব্যক্তাঽব্যক্তাৎ সনাতনঃ।
যঃ স সর্ব্বেষু ভূতেষু নশ্যৎসু ন বিনশ্যতি॥২০॥
অব্যক্তোঽক্ষর ইত্যুক্তস্তমাহুঃ পরমাং গতিম্।
যং প্রাপ্য ন নিবর্ত্তন্তে তদ্ধাম পরমং মম॥২১॥
পুরুষঃ স পরঃ পার্থ ভক্ত্যা লভ্যস্ত্বনন্যয়া।
যস্যান্তঃস্থানি ভূতানি যেন সর্ব্বমিদং ততম্॥২২॥
যত্র কালে ত্বনাবৃত্তিমাবৃত্তিঞ্চৈব যোগিনঃ।
প্রয়াতা যান্তি তং কালং বক্ষ্যামি ভরতর্ষভ॥২৩॥
অগ্নির্জ্যোতিরহঃ শুক্লঃ ষণ্মাসা উত্তরায়ণম্।
তত্র প্রয়াতা গচ্ছন্তি ব্রহ্ম ব্রহ্মবিদো জনাঃ॥২৪॥
ধূমো রাত্রিস্তথা কৃষ্ণঃ ষণ্মাসা দক্ষিণায়নম্।
তত্র চান্দ্রমসং জ্যোতির্যোগী প্রাপ্য নিবর্ত্ততে॥২৫॥
শুক্লকৃষ্ণে গতি হ্যেতে জগতঃ শাশ্বতে মতে।
একয়া যাত্যনাবৃত্তিমন্যয়াবর্ত্ততে পুনঃ॥২৬॥
নৈতে সৃতী পার্থ জানন্ যোগী মুহ্যতি কশ্চন।
তস্মাৎ সর্ব্বেষু কালেষু যোগযুক্তো ভবার্জ্জুন॥২৭॥
বেদেষু যজ্ঞেষু তপঃসু চৈব,
দানেষু যৎ পুণ্যফলং প্রদিষ্টম্।
অত্যেতি তৎ সর্ব্বমিদং বিদিত্বা,
যোগী পরং স্থানমুপৈতি চাদ্যম্॥২৮॥


`;

// Parse
const parsed = parseSlokesWithChapter(gitaText, 1);

// Write to JSON file
fs.writeFileSync(
  "gita_chapter1.json",
  JSON.stringify(parsed, null, 2),
  "utf-8"
);

console.log(parsed);
